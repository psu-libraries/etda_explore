version: '3.5'
services:
  solr:
    image: solr:8.11.1-slim
    restart: always
    environment:
      SOLR_STOP_WAIT: 10
      SOLR_USERNAME: ${SOLR_USERNAME}
      SOLR_PASSWORD: ${SOLR_PASSWORD}
    volumes:
    - solr-data:/var/solr
    - type: bind
      source: ./solr
      target: /tmp
    ports:
    - ${SOLR_PORT:-8983}:8983
    command: [
      "/bin/bash",
      "-c",
      "solr -c && solr auth enable -credentials $$SOLR_USERNAME:$$SOLR_PASSWORD -z localhost:9983; solr stop && solr -c -f",]
volumes:
  solr-data:
